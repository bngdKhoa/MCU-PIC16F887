# INCLUDE <16F887.H> 
# DEVICE ADC = 10 
# FUSES HS 
# USE DELAY (CLOCK = 20M)
CONST UNSIGNED INT8 MA7DOAN [10] = {0XC0, 0XF9, 0XA4, 0XB0, 0X99, 0X92, 0X82, 0XF8, 0X80, 0X90};
UNSIGNED INT16 TEMP;
UNSIGNED INT8 DLHT_8L7D [8] = {0XFF, 0XFF, 0XFF, 0XFF, 0XFF, 0XFF, 0X9C, 0XC6);
VOID HIENTHI_8L7DQ ()
{
   UNSIGNED INT8 I, QUET;
   QUET = 0XFE; // 0B1111 1110
   FOR ( I = 0; I < 8; I++)
   {
      OUTPUT_D (QUET);
      OUTPUT_C (DLHT_8L7D [I]);
      DELAY_US (300); // QUET 30 LAN TRONG 1S (300US LAY 1 LAN)
      OUTPUT_C (0XFF);  // CHONG LEM 
      QUET = (QUET<<1) + 1; // CHUYEN QUA DU LIEU TIEP THEO 
   }
}

# INT_TIMER1
VOID NGAT_TIMER1_QUETLED ()
{
   SET_TIMER1 (-5000); // CHO 5000 XUNG CHO 8MS 
   HIENTHI_8L7DQ ();
}

VOID MAIN ()
{
   SET_TRIS_D (0X00);
   SET_TRIS_C (0X00);
   
   ENABLE_INTERRUPTS (GLOBAL); // CHO PHEP BIEN NGAT TREN TOAN CUC
   ENABLE_INTERRUPTS (INT_TIMER1); // CHO PHEP KHI TIMER1 BI TRAN 
   SETUP_TIMER_1 (T1_INTERNAL |T1_DIV_BY_8);
   SET_TIMER1 (-5000);
   
   SETUP_ADC (ADC_CLOCK_INTERNAL); // CHO PHEP ADC DUNG XUNG NOI
   SETUP_ADC_PORTS (SAN5|VSS_VDD);
   SET_ADC_CHANNEL (5);
   DELAY_MS (10);
   WHILE (TRUE)
   {
      TEMP = READ_ADC ();
      TEMP = TEMP / 2.046;
      DLHT_8L7D [4] = MA7DOAN [TEMP / 10];
      DLHT_8L7D [5] = MA7DOAN [TEMP % 10];
      DELAY_MS (1000);
   }
}
   
   
      
